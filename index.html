<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パチンコ店 タスク割り振り表</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Yuji+Syuku&display=swap" rel="stylesheet">
    
    <style>
        /* Noto Sans JPをUIの基本フォントに設定 */
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: #f8f8f8; /* 明るい背景 */
            color: #333; /* 濃いめのテキスト色 */
        }

        /* ★見出し系に墨っぽいフォントを適用 */
        h1, .section-title, .tab-button {
            font-family: 'Yuji Syuku', 'Noto Sans JP', serif;
            font-weight: 400; /* Yuji Syuku は 400 のみなので太字指定を解除 */
        }

        /* ★タイトル専用のエフェクト */
        h1.title-effect {
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3); /* 影を追加 */
            font-size: 3.25rem; /* 4xl (36px) と 5xl (48px) の中間より大きめ */
        }

        /* カスタムスタイル */
        .tab-button {
            transition: all 0.2s ease-in-out;
            border-bottom: 3px solid transparent;
            color: #6b7280; /* Gray-500 */
        }

        .tab-button.active {
            border-bottom-color: #2563eb; /* Blue-600 */
            color: #1f2937; /* Gray-900 */
            font-weight: 600; /* こちらは可読性のためNoto Sans JPの太字を適用 */
        }

        /* フォーム共通 */
        .form-input, .task-select, .time-select {
            background-color: #ffffff;
            color: #333;
            border: 1px solid #d1d5db; /* Gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 width%3D%2220%22 height%3D%2220%22 fill%3D%22%236B7280%22 viewBox%3D%220 0 20 20%22%3E%3Cpath d%3D%22M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em;
        }
        .form-input { /* テキスト入力欄は矢印なし */
             background-image: none;
        }

        .form-input:focus, .task-select:focus, .time-select:focus {
            border-color: #2563eb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* ボタン共通 */
        .add-button, .add-task-button {
            background-color: #2563eb; /* Blue-600 */
            color: #ffffff;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.15s ease-in-out;
            white-space: nowrap;
        }
        .add-button:hover, .add-task-button:hover {
            background-color: #1d4ed8; /* Blue-700 */
        }
        .add-task-button {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }

        .remove-button, .remove-task-button {
            background-color: transparent;
            color: #ef4444; /* Red-500 */
            border: 1px solid #ef4444;
            border-radius: 9999px; /* rounded-full */
            width: 28px;
            height: 28px;
            font-size: 1.25rem;
            line-height: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease-in-out;
            padding-bottom: 2px; /* for &times; centering */
        }
        .remove-button:hover {
            background-color: #ef4444;
            color: #ffffff;
        }
        .remove-task-button {
            width: 24px;
            height: 24px;
            font-size: 1rem;
            color: #6b7280; /* Gray-500 */
            border: 1px solid #9ca3af; /* Gray-400 */
        }
         .remove-task-button:hover {
            background-color: #6b7280;
            color: #ffffff;
        }


        /* Table styles */
        .task-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: #ffffff;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .task-table thead {
            background-color: #e5e7eb; /* Gray-100 */
        }

        .task-table th,
        .task-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb; /* Gray-200 */
            vertical-align: middle;
        }
        
        .task-table th {
            font-weight: 600;
            color: #4b5563; /* Gray-700 */
            text-transform: uppercase;
            font-size: 0.875rem; /* sm */
        }
        
        .task-table tbody tr:hover {
            background-color: #f9fafb; /* Gray-50 */
        }
        
        /* スタッフ行のスタイル */
        .staff-row td {
            border-bottom-width: 2px; /* スタッフの区切りを太く */
            border-bottom-color: #d1d5db; /* Gray-300 */
        }
        /* タスク行のスタイル */
        .task-row td {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #e5e7eb; /* Gray-200 */
        }
        .task-row:last-child td {
             border-bottom: 2px solid #d1d5db; /* スタッフの最後のタスク行 */
        }
        .task-row .task-label {
            text-align: right;
            font-size: 0.875rem;
            color: #6b7280;
            padding-right: 0.5rem;
        }


        .section-title {
            color: #1f2937; /* Gray-900 */
            border-left-color: #2563eb; /* Blue-600 */
        }
        
        .time-select {
            padding: 0.5rem 0.25rem; /* 小さめのパディング */
            font-size: 0.875rem; /* text-sm */
        }

        /* ★あいまい検索の結果表示用 */
        .search-results {
            position: absolute;
            top: 100%; /* 入力欄のすぐ下に表示 */
            left: 0;
            right: 0;
            background-color: #ffffff;
            border: 1px solid #d1d5db; /* Gray-300 */
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem; /* 下側だけ角丸 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 200px; /* 高すぎないように */
            overflow-y: auto;
            z-index: 10;
        }
        .search-results div {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.15s ease-in-out;
        }
        .search-results div:hover {
            background-color: #f3f4f6; /* Gray-100 */
        }
        
        /* 削除確認モーダル */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 400px;
            width: 90%;
        }

    </style>
</head>
<body class="p-6 md:p-10">

    <div class="max-w-7xl mx-auto">

        <!-- ヘッダー -->
        <header class="text-center mb-10">
            <h1 class="title-effect md:text-6xl text-gray-900 tracking-wide">
                パチンコ店 タスク割り振り表
            </h1>
        </header>
        
        <!-- タブ -->
        <div class="mb-8 border-b border-gray-200">
            <nav class="flex -mb-px space-x-8">
                <button id="tab-open" class="tab-button active text-lg py-3 px-1" onclick="showTab('open')">
                    開店作業 (07:00 - 10:00)
                </button>
                <button id="tab-close" class="tab-button text-lg py-3 px-1" onclick="showTab('close')">
                    閉店作業 (22:50 - 23:30)
                </button>
            </nav>
        </div>

        <!-- メインコンテンツ -->
        <main>
            <!-- 開店作業タブ -->
            <div id="content-open">
                
                <section class="mb-10">
                    <h2 class="text-2xl font-semibold section-title mb-5 border-l-4 pl-4">
                        社員・早番
                    </h2>
                    <!-- ★スタッフ追加フォーム (検索入力) -->
                    <div class="mb-4 flex space-x-2 relative">
                        <input type="text" id="add-staff-name-early" 
                               class="form-input flex-grow" 
                               placeholder="--- 社員を検索・選択 ---"
                               oninput="filterStaff('add-staff-name-early', 'results-early', 'early')"
                               onfocus="filterStaff('add-staff-name-early', 'results-early', 'early')"
                               onclick="event.stopPropagation()"
                               autocomplete="off">
                        <button onclick="addStaff('early', 'add-staff-name-early', 'results-early')" class="add-button">追加</button>
                        <div id="results-early" class="search-results hidden"></div> <!-- 結果表示用 -->
                    </div>
                    <!-- スタッフ一覧テーブル -->
                    <div class="rounded-lg shadow-md overflow-hidden">
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th class="w-1/4">スタッフ名</th>
                                    <th class="w-1/6">開始</th>
                                    <th class="w-1/6">終了</th>
                                    <th class="w-2/5">担当タスク</th>
                                    <th class="w-1/12"></th>
                                </tr>
                            </thead>
                            <tbody id="staff-list-open-early">
                                <!-- スタッフ行はJSで描画 -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <section>
                    <h2 class="text-2xl font-semibold section-title mb-5 border-l-4 pl-4">
                        早番アルバイト
                    </h2>
                    <!-- ★スタッフ追加フォーム (検索入力) -->
                    <div class="mb-4 flex space-x-2 relative">
                        <input type="text" id="add-staff-name-late" 
                               class="form-input flex-grow" 
                               placeholder="--- 早番アルバイトを検索・選択 ---"
                               oninput="filterStaff('add-staff-name-late', 'results-late', 'late')"
                               onfocus="filterStaff('add-staff-name-late', 'results-late', 'late')"
                               onclick="event.stopPropagation()"
                               autocomplete="off">
                        <button onclick="addStaff('late', 'add-staff-name-late', 'results-late')" class="add-button">追加</button>
                        <div id="results-late" class="search-results hidden"></div> <!-- 結果表示用 -->
                    </div>
                    <div class="rounded-lg shadow-md overflow-hidden">
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th class="w-1/4">スタッフ名</th>
                                    <th class="w-1/6">開始</th>
                                    <th class="w-1/6">終了</th>
                                    <th class="w-2/5">担当タスク</th>
                                    <th class="w-1/12"></th>
                                </tr>
                            </thead>
                            <tbody id="staff-list-open-late">
                                <!-- スタッフ行はJSで描画 -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- 閉店作業タブ -->
            <div id="content-close" class="hidden">
                
                <section class="mb-10">
                    <h2 class="text-2xl font-semibold section-title mb-5 border-l-4 pl-4">
                        社員・遅番
                    </h2>
                    <!-- ★スタッフ追加フォーム (検索入力) -->
                    <div class="mb-4 flex space-x-2 relative">
                        <input type="text" id="add-staff-name-closing_employee" 
                               class="form-input flex-grow" 
                               placeholder="--- 社員を検索・選択 ---"
                               oninput="filterStaff('add-staff-name-closing_employee', 'results-closing_employee', 'closing_employee')"
                               onfocus="filterStaff('add-staff-name-closing_employee', 'results-closing_employee', 'closing_employee')"
                               onclick="event.stopPropagation()"
                               autocomplete="off">
                        <button onclick="addStaff('closing_employee', 'add-staff-name-closing_employee', 'results-closing_employee')" class="add-button">追加</button>
                        <div id="results-closing_employee" class="search-results hidden"></div> <!-- 結果表示用 -->
                    </div>
                    <div class="rounded-lg shadow-md overflow-hidden">
                        <table class="task-table">
                           <thead>
                                <tr>
                                    <th class="w-1/4">スタッフ名</th>
                                    <th class="w-1/6">開始</th>
                                    <th class="w-1/6">終了</th>
                                    <th class="w-2/5">担当タスク</th>
                                    <th class="w-1/12"></th>
                                </tr>
                            </thead>
                            <tbody id="staff-list-close-employee">
                                <!-- スタッフ行はJSで描画 -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <section>
                    <h2 class="text-2xl font-semibold section-title mb-5 border-l-4 pl-4">
                        アルバイト・遅番
                    </h2>
                    <!-- ★スタッフ追加フォーム (検索入力) -->
                    <div class="mb-4 flex space-x-2 relative">
                        <input type="text" id="add-staff-name-closing_alba" 
                               class="form-input flex-grow" 
                               placeholder="--- 遅番アルバイトを検索・選択 ---"
                               oninput="filterStaff('add-staff-name-closing_alba', 'results-closing_alba', 'closing_alba')"
                               onfocus="filterStaff('add-staff-name-closing_alba', 'results-closing_alba', 'closing_alba')"
                               onclick="event.stopPropagation()"
                               autocomplete="off">
                        <button onclick="addStaff('closing_alba', 'add-staff-name-closing_alba', 'results-closing_alba')" class="add-button">追加</button>
                        <div id="results-closing_alba" class="search-results hidden"></div> <!-- 結果表示用 -->
                    </div>
                    <div class="rounded-lg shadow-md overflow-hidden">
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th class="w-1/4">スタッフ名</th>
                                    <th class="w-1/6">開始</th>
                                    <th class="w-1/6">終了</th>
                                    <th class="w-2/5">担当タスク</th>
                                    <th class="w-1/12"></th>
                                </tr>
                            </thead>
                            <tbody id="staff-list-close-alba">
                                <!-- スタッフ行はJSで描画 -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

    </div>

    <!-- 削除確認モーダル -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4">削除の確認</h3>
            <p id="delete-modal-message" class="mb-6">本当に削除しますか？</p>
            <div class="flex justify-end space-x-3">
                <button onclick="cancelDelete()" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 transition">
                    キャンセル
                </button>
                <button id="confirm-delete-button" onclick="confirmDelete()" class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition">
                    削除する
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- 設定データ ---

        // スタッフのマスター名簿 (PDFから)
        const masterStaffList = {
            employees: [
                "田村もも乃", "阿部 敏之", "西田在城", "佐藤 大輔", "古場 健悟", 
                "川野 剛史", "浅野貴之", "関口 周吾", "鈴木優希", "鈴木 達也", 
                "成田 健吾", "柳谷 圭亮", "石山峻冴", "小野坂隼", "若松脩斗", "生沼彪"
            ],
            alba_early: [
                "根岸 麻美", "五十嵐 由衣", "曲山 琴菜", "山北 桃香", "上地佑夏", 
                "中村 仁美", "砂川 愛香", "村上麻衣", "小林夏美", "高橋瑞穂", "細田 竜成"
            ],
            alba_late: [
                "富岡 千尋", "浅羽駿汰", "堀切綾", "大山 真菜", "金田 愛伽", 
                "梅津世那", "高橋 良維河", "立岩昭人"
            ]
        };

        // タスクリスト
        const taskLists = {
            open: [
                "金銭計数",
                "近隣店チラシチェック、外販出し、岡持返却、新聞交換",
                "空調、配電系",
                "抽選準備",
                "抽選",
                "台チェック",
                "販促確認",
                "全員9時から朝礼10分"
            ],
            close: [
                "カード点滅つぶし（営業後できるだけ）",
                "立駐2人",
                "事務所清掃",
                "島上クイックルワイパー",
                "引継ぎ記載",
                "施錠確認",
                "飲み残し",
                "工具箱チェック",
                "（営業中）島下確認",
                "（営業中）30π手補給",
                "（営業中）カード点滅つぶし"
            ]
        };
        
        // --- アプリケーション状態 ---

        // タスク割り振りデータ
        let staffList = {
            early: [],
            late: [],
            closing_employee: [],
            closing_alba: []
        };
        
        // 削除確認用の一時保存
        let deleteInfo = { type: null, sectionKey: null, staffIndex: null, taskIndex: null };

        // 時間スロットの事前生成
        const openTimeSlots = generateTimeSlots('07:00', '10:00', 15);
        const closeTimeSlots = generateTimeSlots('22:45', '23:30', 15);

        // --- アプリケーションロジック ---

        document.addEventListener('DOMContentLoaded', () => {
            updateStaffLists();

            // 外側クリックで検索結果を閉じる
            document.addEventListener('click', (event) => {
                const resultsBoxes = document.querySelectorAll('.search-results');
                resultsBoxes.forEach(box => {
                    box.classList.add('hidden');
                });
            });
        });

        /**
         * タブを切り替えます。
         */
        function showTab(tabName) {
            const isOpen = tabName === 'open';
            document.getElementById('content-open').classList.toggle('hidden', !isOpen);
            document.getElementById('content-close').classList.toggle('hidden', isOpen);
            document.getElementById('tab-open').classList.toggle('active', isOpen);
            document.getElementById('tab-close').classList.toggle('active', !isOpen);
        }

        /**
         * sectionKeyからマスターリストのキーを取得するヘルパー
         */
        function getMasterListKey(sectionKey) {
            switch(sectionKey) {
                case 'early':
                case 'closing_employee':
                    return 'employees';
                case 'late':
                    return 'alba_early';
                case 'closing_alba':
                    return 'alba_late';
                default:
                    return 'employees';
            }
        }
        
        /**
         * あいまい検索フィルター
         */
        function filterStaff(inputId, resultsId, sectionKey) {
            event.stopPropagation(); // ★クリックイベントの伝播を停止
            const inputEl = document.getElementById(inputId);
            const resultsEl = document.getElementById(resultsId);
            const query = inputEl.value.toLowerCase().trim();
            
            const masterListKey = getMasterListKey(sectionKey);
            const masterList = masterStaffList[masterListKey];

            // 他の検索結果を隠す
            document.querySelectorAll('.search-results').forEach(box => {
                if (box.id !== resultsId) box.classList.add('hidden');
            });

            resultsEl.innerHTML = '';
            
            const filteredList = masterList.filter(staffName => 
                staffName.toLowerCase().includes(query)
            );

            if (filteredList.length === 0) {
                resultsEl.innerHTML = `<div class="p-3 text-gray-500 italic">該当者なし</div>`;
            } else {
                filteredList.forEach(staffName => {
                    // ' を含む名前に対応
                    const escapedName = staffName.replace(/'/g, "\\'");
                    resultsEl.innerHTML += `<div onclick="selectStaff('${inputId}', '${resultsId}', '${escapedName}')">${staffName}</div>`;
                });
            }
            resultsEl.classList.remove('hidden');
        }

        /**
         * 検索結果からスタッフを選択
         */
        function selectStaff(inputId, resultsId, staffName) {
            event.stopPropagation(); // ★
            document.getElementById(inputId).value = staffName;
            document.getElementById(resultsId).classList.add('hidden');
        }

        /**
         * スタッフをリストに追加します。
         */
        function addStaff(sectionKey, inputId, resultsId) {
            const inputEl = document.getElementById(inputId);
            const staffName = inputEl.value;

            if (staffName === "") return;
            
            const masterListKey = getMasterListKey(sectionKey);
            if (!masterStaffList[masterListKey].includes(staffName)) {
                return; // マスターにない名前は追加しない
            }
            
            if (staffList[sectionKey].find(staff => staff.name === staffName)) {
                inputEl.value = ""; 
                document.getElementById(resultsId).classList.add('hidden');
                return; // 既に追加済み
            }

            staffList[sectionKey].push({
                name: staffName,
                tasks: [{ start: "", end: "", task: "" }]
            });
            inputEl.value = "";
            document.getElementById(resultsId).classList.add('hidden');
            updateStaffLists();
        }

        /**
         * 特定のスタッフにタスクを追加します。
         */
        function addTask(sectionKey, staffIndex) {
            staffList[sectionKey][staffIndex].tasks.push({ start: "", end: "", task: "" });
            updateStaffLists();
        }

        /**
         * 削除モーダルを表示します。
         */
        function showDeleteModal(type, sectionKey, staffIndex, taskIndex = null) {
            deleteInfo = { type, sectionKey, staffIndex, taskIndex };
            const modal = document.getElementById('delete-modal');
            const messageEl = document.getElementById('delete-modal-message');
            
            if (type === 'staff') {
                const staffName = staffList[sectionKey][staffIndex].name;
                messageEl.textContent = `「${staffName}」さんをリストから削除します。よろしいですか？`;
            } else { // type === 'task'
                messageEl.textContent = `このタスクを削除します。よろしいですか？`;
            }
            modal.classList.remove('hidden');
        }

        /**
         * 削除をキャンセルします。
         */
        function cancelDelete() {
            document.getElementById('delete-modal').classList.add('hidden');
            deleteInfo = { type: null, sectionKey: null, staffIndex: null, taskIndex: null };
        }

        /**
         * 削除を確定実行します。
         */
        function confirmDelete() {
            const { type, sectionKey, staffIndex, taskIndex } = deleteInfo;

            if (type === 'staff') {
                staffList[sectionKey].splice(staffIndex, 1);
            } else if (type === 'task') {
                staffList[sectionKey][staffIndex].tasks.splice(taskIndex, 1);
                // もしタスクが0になったらスタッフごと消すか？ -> 一旦タスクが0でもスタッフは残す仕様
            }
            
            cancelDelete(); // モーダルを閉じる
            updateStaffLists(); // リストを再描画
        }

        /**
         * タスクや時間の変更をデータに保存します。
         */
        function handleChange(sectionKey, staffIndex, taskIndex, field, value) {
            try {
                staffList[sectionKey][staffIndex].tasks[taskIndex][field] = value;
            } catch (e) {
                console.error("Error updating data:", {sectionKey, staffIndex, taskIndex, field, value}, e);
            }
        }

        /**
         * 全てのスタッフリストのHTMLを再描画します。
         */
        function updateStaffLists() {
            populateStaffList('staff-list-open-early', 'early', taskLists.open, openTimeSlots);
            populateStaffList('staff-list-open-late', 'late', taskLists.open, openTimeSlots);
            populateStaffList('staff-list-close-employee', 'closing_employee', taskLists.close, closeTimeSlots);
            populateStaffList('staff-list-close-alba', 'closing_alba', taskLists.close, closeTimeSlots);
        }

        /**
         * スタッフリストとタスク選択プルダウンを生成して配置します。
         */
        function populateStaffList(containerId, sectionKey, tasks, timeSlots) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = ''; // コンテナをクリア
            
            // タスクと時間の<option>HTMLを事前に生成
            const taskOptions = '<option value="">--- タスクを選択 ---</option>' + tasks.map(task => 
                `<option value="${task}">${task}</option>`
            ).join('');
            
            const timeOptions = '<option value="">--</option>' + timeSlots.map(time => 
                `<option value="${time}">${time}</option>`
            ).join('');

            // staffListから該当セクションのスタッフを描画
            staffList[sectionKey].forEach((staff, staffIndex) => {
                
                let staffHtml = '';
                const staffName = staff.name.replace(/'/g, "\\'"); // 'エスケープ

                staff.tasks.forEach((task, taskIndex) => {
                    if (taskIndex === 0) {
                        // 1行目 (スタッフ名 + 最初のタスク)
                        staffHtml += `
                            <tr class="staff-row">
                                <!-- スタッフ名 -->
                                <td class="font-medium text-gray-800">
                                    <div class="flex items-center justify-between">
                                        <span class="text-lg">${staff.name}</span>
                                        <button onclick="showDeleteModal('staff', '${sectionKey}', ${staffIndex})" 
                                                class="remove-button" 
                                                title="${staffName} さんを削除">&times;</button>
                                    </div>
                                </td>
                                <!-- 1行目のタスク -->
                                <td class="w-1/6">
                                    <select class="time-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'start', this.value)">
                                        ${timeOptions.replace(`value="${task.start}"`, `value="${task.start}" selected`)}
                                    </select>
                                </td>
                                <td class="w-1/6">
                                    <select class="time-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'end', this.value)">
                                        ${timeOptions.replace(`value="${task.end}"`, `value="${task.end}" selected`)}
                                    </select>
                                </td>
                                <td class="w-2/5">
                                    <select class="task-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'task', this.value)">
                                        ${taskOptions.replace(`value="${task.task}"`, `value="${task.task}" selected`)}
                                    </select>
                                </td>
                                <td class="w-1/12 text-center">
                                    <!-- 1行目でもタスク削除ボタンを配置 (タスクが2個以上の場合のみ) -->
                                    ${staff.tasks.length > 1 ? 
                                        `<button onclick="showDeleteModal('task', '${sectionKey}', ${staffIndex}, ${taskIndex})" 
                                                 class="remove-task-button" 
                                                 title="このタスクを削除">－</button>` : ''}
                                </td>
                            </tr>`;
                    } else {
                        // 2行目以降のタスク
                        staffHtml += `
                            <tr class="task-row">
                                <td class="task-label">
                                    <button onclick="addTask('${sectionKey}', ${staffIndex})" 
                                            class="add-task-button" 
                                            title="タスクを追加">+ タスク追加</button>
                                </td>
                                <td class="w-1/6">
                                    <select class="time-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'start', this.value)">
                                        ${timeOptions.replace(`value="${task.start}"`, `value="${task.start}" selected`)}
                                    </select>
                                </td>
                                <td class="w-1/6">
                                    <select class="time-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'end', this.value)">
                                        ${timeOptions.replace(`value="${task.end}"`, `value="${task.end}" selected`)}
                                    </select>
                                </td>
                                <td class="w-2/5">
                                    <select class="task-select w-full" onchange="handleChange('${sectionKey}', ${staffIndex}, ${taskIndex}, 'task', this.value)">
                                        ${taskOptions.replace(`value="${task.task}"`, `value="${task.task}" selected`)}
                                    </select>
                                </td>
                                <td class="w-1/12 text-center">
                                    <button onclick="showDeleteModal('task', '${sectionKey}', ${staffIndex}, ${taskIndex})" 
                                            class="remove-task-button" 
                                            title="このタスクを削除">－</button>
                                </td>
                            </tr>`;
                    }
                });
                
                // タスクが1つの場合、「+ タスク追加」ボタンを行の最後に表示
                if (staff.tasks.length === 1) {
                     staffHtml += `
                        <tr class="task-row">
                            <td class="task-label" colspan="5">
                                <button onclick="addTask('${sectionKey}', ${staffIndex})" 
                                        class="add-task-button" 
                                        title="タスクを追加">+ タスク追加</button>
                            </td>
                        </tr>`;
                }
                
                container.innerHTML += staffHtml;
            });
        }

        /**
         * 指定された時間範囲と間隔で時間スロットの配列を生成します。
         */
        function generateTimeSlots(startTime, endTime, intervalMinutes) {
            const slots = [];
            let [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);

            let currentMinutes = startHour * 60 + startMin;
            const endTotalMinutes = endHour * 60 + endMin;

            while (currentMinutes <= endTotalMinutes) {
                const hour = Math.floor(currentMinutes / 60);
                const minute = currentMinutes % 60;
                
                slots.push(
                    `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`
                );
                
                currentMinutes += intervalMinutes;
            }
            return slots;
        }

    </script>
</body>
</html>

